generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Facility {
  id               String   @id @default(cuid())
  name             String
  type             String
  address          String
  latitude         Float
  longitude        Float
  yakap_accredited Boolean  @default(false)
  services         String[]
  operating_hours  Json
  photos           String[]
  barangay         String?
  specialized_services String[] @default([])
  is_24_7          Boolean  @default(false)
  capacity         Int      @default(50)
  live_metrics     Json     @default("{}")
  busy_patterns    Json     @default("{}")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  signals          FacilitySignal[]
  contacts         FacilityContact[]

  @@index([latitude, longitude])
  @@index([type])
}

model FacilityContact {
  id             String   @id @default(cuid())
  phoneNumber    String
  platform       String   @default("phone")
  teleconsultUrl String?
  contactName    String?
  role           String?
  facilityId     String
  facility       Facility @relation(fields: [facilityId], references: [id], onDelete: Cascade)

  @@index([facilityId])
}

model FacilitySignal {
  id           String   @id @default(cuid())
  facilityId   String
  facility     Facility @relation(fields: [facilityId], references: [id])
  visitorHash  String
  timestamp    DateTime @default(now())

  @@index([facilityId, timestamp])
}

model Symptom {
  id                  String   @id @default(cuid())
  name                String
  category            String
  keywords            String[]
  red_flags           String[]
  recommended_care    String
  follow_up_questions String[] @default([])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([category])
}

model UserEnrollment {
  id                  String   @id @default(cuid())
  user_id             String   @unique
  username            String   @unique
  phone_number        String   @unique
  enrollment_pathway  String?
  progress_step       Int      @default(0)
  completed           Boolean  @default(false)
  documents_uploaded  Json?
  chronic_conditions  String[] @default([])
  allergies           String[] @default([])
  current_medications String[] @default([])
  surgical_history    String?
  family_history      String?
  dob                 DateTime?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  clinicalHistories   ClinicalHistory[]

  @@index([user_id])
  @@index([phone_number])
}

model ClinicalHistory {
  id                 String           @id @default(cuid())
  userEnrollmentId   String
  userEnrollment     UserEnrollment   @relation(fields: [userEnrollmentId], references: [id], onDelete: Cascade)
  payload            Json
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt

  @@index([userEnrollmentId])
}

model EmergencyContact {
  id            String   @id @default(cuid())
  name          String
  category      String
  phone         String
  available24x7 Boolean  @default(true)
  description   String?
  createdAt     DateTime @default(now())
}

model Medication {

  id             String   @id @default(cuid())

  name           String

  dosage         String?

  scheduled_time String?

  is_active      Boolean  @default(true)

  days_of_week   String[] @default([])

  createdAt      DateTime @default(now())

  updatedAt      DateTime @updatedAt



  @@index([name])

}



model HealthFeed {

  id        String   @id @default(cuid())

  externalId String  @unique // Hash of URL or ID from WP

  title     String

  excerpt   String

  url       String

  imageUrl  String?

  dateISO   DateTime

  author    String   @default("Naga City Health")

  createdAt DateTime @default(now())

  updatedAt DateTime @updatedAt



  @@index([dateISO])

}


