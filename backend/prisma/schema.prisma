generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model Facility {
  id               String   @id @default(cuid())
  name             String
  type             String
  address          String
  latitude         Float
  longitude        Float
  phone            String?
  yakap_accredited Boolean  @default(false)
  services         String[]
  operating_hours  Json
  photos           String[]
  barangay         String?
  specialized_services String[] @default([])
  is_24_7          Boolean  @default(false)
  capacity         Int      @default(50)
  live_metrics     Json     @default("{}")
  busy_patterns    Json     @default("{}")
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  signals          FacilitySignal[]

  @@index([latitude, longitude])
  @@index([type])
}

model FacilitySignal {
  id           String   @id @default(cuid())
  facilityId   String
  facility     Facility @relation(fields: [facilityId], references: [id])
  visitorHash  String
  timestamp    DateTime @default(now())

  @@index([facilityId, timestamp])
}

model Symptom {
  id                  String   @id @default(cuid())
  name                String
  category            String
  keywords            String[]
  red_flags           String[]
  recommended_care    String
  follow_up_questions String[] @default([])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([category])
}

model UserEnrollment {
  id                 String   @id @default(cuid())
  user_id            String   @unique
  phone_number       String   @unique
  enrollment_pathway String?
  progress_step      Int      @default(0)
  completed          Boolean  @default(false)
  documents_uploaded Json?
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt

  @@index([user_id])
  @@index([phone_number])
}

model EmergencyContact {
  id            String   @id @default(cuid())
  name          String
  category      String
  phone         String
  available24x7 Boolean  @default(true)
  description   String?
  createdAt     DateTime @default(now())
}
