# Triage Gating Test Scenarios

| Scenario                     | Signal / State                                                                                                                                             | Expected Extraction Behavior                                                                                                                                                                                       |
| ---------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 1. Clarification loop        | `REQUIRE_CLARIFICATION` triggered when `profile.denial_confidence === 'low'` (see `triageArbiter.ts:62`)                                                   | `extractClinicalProfile` must rerun on the latest turn before allowing the clarification prompt to proceed so the arbiter can re-evaluate ambiguity with fresh evidence.                                           |
| 2. Ambiguity guard           | `RESOLVE_AMBIGUITY` from `profile.ambiguity_detected && !profile.uncertainty_accepted` (`triageArbiter.ts:366`)                                            | Each turn that produces this signal must call the AI extraction again to confirm whether the ambiguity persists prior to permitting termination.                                                                   |
| 3. Friction guard            | `RESOLVE_FRICTION` when `profile.clinical_friction_detected` (`triageArbiter.ts:369`)                                                                      | Extraction must be invoked to update `clinical_friction_details`; the arbiter should never allow local-only resolution while friction remains flagged.                                                             |
| 4. Red-flag gate             | `PRIORITIZE_RED_FLAGS` (or `CONTINUE` while `profile.red_flags_resolved === false` and remaining `is_red_flag` questions exist) (`triageArbiter.ts:77`)    | After the red-flag questions finish, the subsequent turn must re-run extraction to verify `red_flags_resolved` before exiting the gate, preventing bypass via stale data.                                          |
| 5. Turn floor enforcement    | `CONTINUE` because `currentTurn < minTurnsRequired` (`triageArbiter.ts:125`)                                                                               | While the deterministic floor is active and any new answer arrives, the turn must still trigger extraction so the arbiter can reconsider whether the floor remains necessary (e.g., if a new critical slot fills). |
| 6. Saturation termination    | `TERMINATE` when `calculateSaturation` reports true (readiness 1.0 + two stable turns) (`triageArbiter.ts:63`)                                             | Both turns used to confirm saturation must result from executing the AI extraction so that the arbiter can see the stable profile before allowing closure.                                                         |
| 7. Data completeness failure | `CONTINUE` because `evaluateDataCompleteness` reports missing `age`/`duration`/`severity`/`red_flag_denials` or readiness `< 0.9` (`triageArbiter.ts:331`) | Extraction should run on each turn until the missing slots or the readiness score improves, ensuring the arbiter has up-to-date slot values before signaling termination.                                          |

Each scenario should be covered by a regression or integration test that asserts both the arbiter signal/state and whether `extractClinicalProfile` is invoked, ensuring no emergency or red-flag path bypasses required AI processing.
